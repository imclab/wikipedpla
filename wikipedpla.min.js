var wp={title:$("#firstHeading").text(),categories:[],otherTitles:[],redirects:[],getCategories:function(){$("#mw-normal-catlinks li").each(function(e,t){wp.categories.push($(t).text())})},getOtherTitles:function(){$(".dablink").each(function(e,t){var i=$(t).text().match('"(.*)" redirects here.');i&&wp.otherTitles.push(i[1])})}},dpla={},suggestions=[],buildURI=function(e){var t="e4c036f3302aad8d8c188683967b9619",i="http://api.dp.la/v2/items";return i+"?api_key="+t+"&q="+encodeURIComponent(e)+"&callback=_handleResponse"},getData=function(e){$("body").append('<script src="'+buildURI(e)+'"></script>')},_handleResponse=function(e){dpla=e;var t=dpla.docs.length;t>0?buildSuggestions(displaySuggestions):wp.otherTitles.length>0?getData(wp.otherTitles.pop()):wp.categories.length>0&&getData(wp.categories.pop())},trunc=function(e,t){var i=parseInt(t,10)||60,n=e.replace(/(\s\/)$/,"");return n.length>i?n.substr(0,i).replace(/\s$/,"")+"&hellip;":n},buildSuggestions=function(e){var t=dpla.docs,i={};$.each(t,function(e,t){var n=t.sourceResource;i.title=$.isArray(n.title)?n.title[0]:n.title,i.title=trunc(i.title),i.uri=t.isShownAt,i.isImage=isItAnImage(n),suggestions.push(i),i={}}),"function"==typeof e&&e()},rmAngles=function(e){return e.replace("<","&lt;").replace(">","&gt;")},addToDOM=function(e){var t=$("#firstHeading").add(".dablink"),i=function(e){t.visible(!0)&&($("#wikipedpla").show("slow"),$(window).off("scroll",i))};$("#mw-content-text").prepend(e),$("#wikipedpla").css("display","hidden"),t.visible(!0)?$("#wikipedpla").show("slow"):$(window).on("scroll",i)},displaySuggestions=function(){var e='<style>.dp-img:after { content: " "; background: url(https://upload.wikimedia.org/wikipedia/commons/a/a3/VisualEditor_-_Icon_-_Picture.svg); width: 12px; height: 12px; display: inline-block; background-size: 12px 12px;} }</style><div id="wikipedpla" class="dablink" style="display:none;"><a href="http://dp.la">DPLA</a> ',t=!1,i=suggestions,n=i.length;1===n?(e+="item of possible interest:",e+=' <a href="'+rmAngles(i[0].uri)+'"',i[0].isImage&&(e+=' class="dp-img"'),e+=">"+rmAngles(i[0].title)+"</a>."):(e+="items of possible interest:",$.each(i,function(i,s){i+1===n&&(t=!0),t&&(e+=" & "),e+=' <a href="'+rmAngles(s.uri)+'"',s.isImage&&(e+=' class="dp-img"'),e+=">"+rmAngles(s.title),e+=t?"</a>.":"</a>,"})),e+="</div>",addToDOM(e)},isItAnImage=function(e){var t=e.type;if($.isArray(t)){for(var i in t)if(t.hasOwnProperty(i)&&"image"===i.toLowerCase())return!0;return!1}return t&&"image"===t.toLowerCase()?!0:!1},init=function(){var e=$('li[id^="ca-nstab-"]'),t=e.attr("id"),i="Main Page"===e.text();window._handleResponse||(window._handleResponse=_handleResponse),"undefined"!=typeof unsafeWindow&&(unsafeWindow._handleResponse=_handleResponse),"main"!==t.substr(-4)||i||(wp.getCategories(),wp.getOtherTitles(),getData(wp.title))};!function(e){var t=e(window);e.fn.visible=function(e,i,n){if(!(this.length<1)){var s=this.length>1?this.eq(0):this,a=s.get(0),o=t.width(),r=t.height(),n=n?n:"both",l=i===!0?a.offsetWidth*a.offsetHeight:!0;if("function"==typeof a.getBoundingClientRect){var p=a.getBoundingClientRect(),d=p.top>=0&&p.top<r,c=p.bottom>0&&p.bottom<=r,g=p.left>=0&&p.left<o,u=p.right>0&&p.right<=o,h=e?d||c:d&&c,f=e?g||g:g&&u;if("both"===n)return l&&h&&f;if("vertical"===n)return l&&h;if("horizontal"===n)return l&&f}else{var w=t.scrollTop(),m=w+r,b=t.scrollLeft(),v=b+o,$=s.offset(),y=$.top,k=y+s.height(),R=$.left,I=R+s.width(),_=e===!0?k:y,A=e===!0?y:k,x=e===!0?I:R,T=e===!0?R:I;if("both"===n)return!!l&&m>=A&&_>=w&&v>=T&&x>=b;if("vertical"===n)return!!l&&m>=A&&_>=w;if("horizontal"===n)return!!l&&v>=T&&x>=b}}}}(jQuery),init();