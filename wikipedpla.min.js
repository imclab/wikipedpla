var wp={title:$("#firstHeading").text(),categories:[],otherTitles:[],redirects:[],getCategories:function(){$("#mw-normal-catlinks li").each(function(t,e){wp.categories.push($(e).text())})},getOtherTitles:function(){$(".dablink").each(function(t,e){test=$(e).text().match('"(.*)" redirects here.'),test&&wp.otherTitles.push(test[1])})}},catCounter=0,titleCounter=0,dpla={},suggestions=[],buildURI=function(t){var e="e4c036f3302aad8d8c188683967b9619",i="http://api.dp.la/v2/items";return i+"?api_key="+e+"&q="+encodeURIComponent(t)+"&callback=_handleResponse"},getData=function(t){$("body").append('<script src="'+buildURI(t)+'"></script>')},_handleResponse=function(t){dpla=t;var e=dpla.docs.length;e>0?buildSuggestions(displaySuggestions):titleCounter<wp.otherTitles.length?(getData(wp.otherTitles[titleCounter]),titleCounter++):catCounter<wp.categories.length&&(getData(wp.categories[catCounter]),catCounter++)},trunc=function(t,e){var i=parseInt(e,10)||60,n=t.replace(/(\s\/)$/,"");return n.length>i?n.substr(0,i).replace(/\s$/,"")+"&hellip;":n},buildSuggestions=function(t){var e=dpla.docs,i={};$.each(e,function(t,e){var n=e.sourceResource;i.title=$.isArray(n.title)?n.title[0]:n.title,i.title=trunc(i.title),i.uri=e.isShownAt,i.isImage=isItAnImage(n),suggestions.push(i),i={}}),"function"==typeof t&&t()},rmAngles=function(t){return t.replace("<","&lt;").replace(">","&gt;")},addToDOM=function(t){var e=$("#firstHeading").add(".dablink"),i=function(t){e.visible(!0)&&($("#wikipedpla").show("slow"),$(window).off("scroll",i))};$("#mw-content-text").prepend(t),$("#wikipedpla").css("display","hidden"),e.visible(!0)?$("#wikipedpla").show("slow"):$(window).on("scroll",i)},displaySuggestions=function(){var t='<style>.dp-img:after { content: " "; background: url(https://upload.wikimedia.org/wikipedia/commons/a/a3/VisualEditor_-_Icon_-_Picture.svg); width: 12px; height: 12px; display: inline-block; background-size: 12px 12px;} }</style><div id="wikipedpla" class="dablink" style="display:none;"><a href="http://dp.la">DPLA</a> ',e=!1,i=suggestions,n=i.length;1===n?(t+="item of possible interest:",t+=' <a href="'+rmAngles(i[0].uri)+'"',i[0].isImage&&(t+=' class="dp-img"'),t+=">"+rmAngles(i[0].title)+"</a>."):(t+="items of possible interest:",$.each(i,function(i,s){i+1==n&&(e=!0),e&&(t+=" & "),t+=' <a href="'+rmAngles(s.uri)+'"',s.isImage&&(t+=' class="dp-img"'),t+=">"+rmAngles(s.title),t+=e?"</a>.":"</a>,"})),t+="</div>",addToDOM(t)},isItAnImage=function(t){var e=t.type;if($.isArray(e)){for(var i in e)if(e.hasOwnProperty(i)&&"image"==i.toLowerCase())return!0;return!1}return e&&"image"===e.toLowerCase()?!0:!1},init=function(){var t=$('li[id^="ca-nstab-"]'),e=t.attr("id"),i="Main Page"===t.text();window._handleResponse||(window._handleResponse=_handleResponse),"undefined"!=typeof unsafeWindow&&(unsafeWindow._handleResponse=_handleResponse),"main"!==e.substr(-4)||i||(wp.getCategories(),wp.getOtherTitles(),getData(wp.title))};!function(t){var e=t(window);t.fn.visible=function(t,i,n){if(!(this.length<1)){var s=this.length>1?this.eq(0):this,o=s.get(0),a=e.width(),r=e.height(),n=n?n:"both",l=i===!0?o.offsetWidth*o.offsetHeight:!0;if("function"==typeof o.getBoundingClientRect){var d=o.getBoundingClientRect(),p=d.top>=0&&d.top<r,c=d.bottom>0&&d.bottom<=r,u=d.left>=0&&d.left<a,g=d.right>0&&d.right<=a,h=t?p||c:p&&c,f=t?u||u:u&&g;if("both"===n)return l&&h&&f;if("vertical"===n)return l&&h;if("horizontal"===n)return l&&f}else{var w=e.scrollTop(),m=w+r,b=e.scrollLeft(),v=b+a,$=s.offset(),y=$.top,k=y+s.height(),C=$.left,R=C+s.width(),I=t===!0?k:y,_=t===!0?y:k,A=t===!0?R:C,x=t===!0?C:R;if("both"===n)return!!l&&m>=_&&I>=w&&v>=x&&A>=b;if("vertical"===n)return!!l&&m>=_&&I>=w;if("horizontal"===n)return!!l&&v>=x&&A>=b}}}}(jQuery),init();