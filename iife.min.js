!function(e,t,i){var a={title:$("#firstHeading").text(),categories:[],otherTitles:[],redirects:[],getCategories:function(){$("#mw-normal-catlinks li").each(function(e,t){a.categories.push($(t).text())})},getOtherTitles:function(){$(".dablink").each(function(e,t){var i=$(t).text().match('"(.*)" redirects here.');i&&a.otherTitles.push(i[1])})}},n={},r=[],s=function(e){var t="e4c036f3302aad8d8c188683967b9619",i="http://api.dp.la/v2/items";return i+"?api_key="+t+"&q="+encodeURIComponent(e)+"&callback=_handleResponse"},o=function(e){$("body").append('<script src="'+s(e)+'"></script>')},l=function(e){n=e;var t=n.docs.length;t>0?d(h):a.otherTitles.length>0?o(a.otherTitles.pop()):a.categories.length>0&&o(a.categories.pop())},c=function(e,t){var i=parseInt(t,10)||60,a=e.replace(/(\s\/)$/,"");return a.length>i?a.substr(0,i).replace(/\s$/,"")+"&hellip;":a},d=function(e){var t=n.docs,i={};$.each(t,function(e,t){var a=t.sourceResource;i.title=$.isArray(a.title)?a.title[0]:a.title,i.title=c(i.title),i.uri=t.isShownAt,i.isImage=f(a),r.push(i),i={}}),"function"==typeof e&&e()},p=function(e){return e.replace("<","&lt;").replace(">","&gt;")},u=function(e){var t=$("#firstHeading").add(".dablink");$("#mw-content-text").prepend(e),$("#wikipedpla").show("slow")},h=function(){var e='<style>.dp-img:after { content: " "; background: url(https://upload.wikimedia.org/wikipedia/commons/a/a3/VisualEditor_-_Icon_-_Picture.svg); width: 12px; height: 12px; display: inline-block; background-size: 12px 12px;} }</style><div id="wikipedpla" class="dablink" style="display:none;"><a href="http://dp.la">DPLA</a> ',t=!1,i=r,a=i.length;1===a?(e+="item of possible interest:",e+=' <a href="'+p(i[0].uri)+'"',i[0].isImage&&(e+=' class="dp-img"'),e+=">"+p(i[0].title)+"</a>."):(e+="items of possible interest:",$.each(i,function(i,n){i+1===a&&(t=!0),t&&(e+=" & "),e+=' <a href="'+p(n.uri)+'"',n.isImage&&(e+=' class="dp-img"'),e+=">"+p(n.title),e+=t?"</a>.":"</a>,"})),e+="</div>",u(e)},f=function(e){var t=e.type;if($.isArray(t)){for(var i in t)if(t.hasOwnProperty(i)&&"image"===i.toLowerCase())return!0;return!1}return t&&"image"===t.toLowerCase()?!0:!1},g=function(){var t=$('li[id^="ca-nstab-"]'),i=t.attr("id"),n="Main Page"===t.text();e._handleResponse||(e._handleResponse=l),"undefined"!=typeof unsafeWindow&&(unsafeWindow._handleResponse=l),"main"!==i.substr(-4)||n||(a.getCategories(),a.getOtherTitles(),o(a.title)),$("#loaddpla").off("click",g).css("cursor","default").removeAttr("title")};$("#firstHeading").append('<a title="load DPLA results" id="loaddpla" style="cursor:pointer;margin-left:.4em;vertical-align:top;"><img src="https://dl.dropboxusercontent.com/u/23539776/dpla.png" style="height:1em;width:1em;" alt="DPLA logo"></a>'),$("#loaddpla").on("click",g)}(window,document);